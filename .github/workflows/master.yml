name: ğŸ¯ Master CI/CD Orchestration

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  AWS_REGION: eu-central-1
  CLUSTER_NAME: iagent-cluster-v2

jobs:
  # Orchestrate all workflows
  orchestrate:
    name: ğŸ¯ Orchestrate CI/CD
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js 18
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ”„ Sync Nx workspace
      run: npx nx sync --yes
      
    - name: ğŸ§ª Run quick tests
      run: |
        echo "ğŸ§ª Running quick tests..."
        npx nx run-many --target=test --projects=frontend,backend --parallel=2
        echo "âœ… Quick tests passed"
        
    - name: ğŸ—ï¸ Quick build check
      run: |
        echo "ğŸ—ï¸ Quick build check..."
        npx nx run-many --target=build --projects=frontend,backend --parallel=2
        echo "âœ… Build check passed"
        
    - name: ğŸ‰ All checks passed
      run: |
        echo "ğŸ‰ All CI/CD checks passed!"
        echo "ğŸš€ Ready for deployment"
        echo "ğŸ“Š Frontend will deploy to GitHub Pages"
        echo "ğŸ³ Backend will deploy to AWS EKS"
        echo "ğŸ—ï¸ Infrastructure ready for deployment"
