name: 🧪 Test AWS Connection

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths: [ '.github/workflows/test-aws-connection.yml' ]

env:
  AWS_REGION: eu-central-1

jobs:
  test-aws:
    name: 🧪 Test AWS Connection
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: 🔐 Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}
        
    - name: 🔍 Test AWS Setup
      run: |
        echo "🧪 Testing AWS setup in GitHub Actions..."
        
        # Test environment variables
        echo "🔍 Checking AWS environment variables..."
        echo "   ✅ AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:0:8}..."
        echo "   ✅ AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:0:8}..."
        echo "   ✅ AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
        echo "   ✅ AWS_REGION: $AWS_REGION"
        
        # Test AWS CLI availability
        echo "🔍 Checking AWS CLI availability..."
        if command -v aws &> /dev/null; then
            echo "   ✅ AWS CLI is available"
            aws --version
        else
            echo "   ⚠️  AWS CLI not available (this is normal in some runners)"
        fi
        
        # Test AWS credentials validation
        echo "🔍 Testing AWS credentials..."
        if command -v aws &> /dev/null; then
            if aws sts get-caller-identity > /dev/null 2>&1; then
                echo "   ✅ AWS credentials are valid!"
                echo "   🎯 Identity: $(aws sts get-caller-identity --query 'Arn' --output text)"
            else
                echo "   ❌ AWS credentials validation failed"
                exit 1
            fi
        else
            echo "   ⚠️  Skipping AWS CLI test (CLI not available)"
        fi
        
        echo "✅ AWS setup test completed successfully!"
        echo "   🚀 Ready for deployment workflows!"
