name: ğŸ§ª Test AWS Connection

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths: [ '.github/workflows/test-aws-connection.yml' ]

env:
  AWS_REGION: eu-central-1

jobs:
  test-aws:
    name: ğŸ§ª Test AWS Connection
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}
        
    - name: ğŸ” Test AWS Setup
      run: |
        echo "ğŸ§ª Testing AWS setup in GitHub Actions..."
        
        # Test environment variables
        echo "ğŸ” Checking AWS environment variables..."
        echo "   âœ… AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:0:8}..."
        echo "   âœ… AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:0:8}..."
        echo "   âœ… AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
        echo "   âœ… AWS_REGION: $AWS_REGION"
        
        # Test AWS CLI availability
        echo "ğŸ” Checking AWS CLI availability..."
        if command -v aws &> /dev/null; then
            echo "   âœ… AWS CLI is available"
            aws --version
        else
            echo "   âš ï¸  AWS CLI not available (this is normal in some runners)"
        fi
        
        # Test AWS credentials validation
        echo "ğŸ” Testing AWS credentials..."
        if command -v aws &> /dev/null; then
            if aws sts get-caller-identity > /dev/null 2>&1; then
                echo "   âœ… AWS credentials are valid!"
                echo "   ğŸ¯ Identity: $(aws sts get-caller-identity --query 'Arn' --output text)"
            else
                echo "   âŒ AWS credentials validation failed"
                exit 1
            fi
        else
            echo "   âš ï¸  Skipping AWS CLI test (CLI not available)"
        fi
        
        echo "âœ… AWS setup test completed successfully!"
        echo "   ğŸš€ Ready for deployment workflows!"
